<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <!-- URL Rewrite rules for Local Gigs App (ONCE AGAIN I HAD TO SK CHATGPT FOR HELP FOR THIS SORRY) -->
        <rewrite>
            <rules>
                <!-- Redirect trailing slashes for directories to .html files -->
                <rule name="RedirectProfileSlash" stopProcessing="true">
                    <match url="^profile/$" />
                    <action type="Redirect" url="profile.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectEventsSlash" stopProcessing="true">
                    <match url="^events/$" />
                    <action type="Redirect" url="events.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectVenuesSlash" stopProcessing="true">
                    <match url="^venues/$" />
                    <action type="Redirect" url="venues.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectDashboardSlash" stopProcessing="true">
                    <match url="^dashboard/$" />
                    <action type="Redirect" url="dashboard.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectLoginSlash" stopProcessing="true">
                    <match url="^login/$" />
                    <action type="Redirect" url="login.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectSignupSlash" stopProcessing="true">
                    <match url="^signup/$" />
                    <action type="Redirect" url="signup.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectConfirmSlash" stopProcessing="true">
                    <match url="^confirm/$" />
                    <action type="Redirect" url="confirm.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectProfileSetupSlash" stopProcessing="true">
                    <match url="^profile-setup/$" />
                    <action type="Redirect" url="profile-setup.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectEventDetailsSlash" stopProcessing="true">
                    <match url="^event-details/$" />
                    <action type="Redirect" url="event-details.html" redirectType="Permanent" />
                </rule>

                <!-- Redirect pages without extension to .html files -->
                <rule name="RedirectProfile" stopProcessing="true">
                    <match url="^profile$" />
                    <action type="Redirect" url="profile.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectEvents" stopProcessing="true">
                    <match url="^events$" />
                    <action type="Redirect" url="events.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectVenues" stopProcessing="true">
                    <match url="^venues$" />
                    <action type="Redirect" url="venues.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectDashboard" stopProcessing="true">
                    <match url="^dashboard$" />
                    <action type="Redirect" url="dashboard.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectLogin" stopProcessing="true">
                    <match url="^login$" />
                    <action type="Redirect" url="login.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectSignup" stopProcessing="true">
                    <match url="^signup$" />
                    <action type="Redirect" url="signup.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectConfirm" stopProcessing="true">
                    <match url="^confirm$" />
                    <action type="Redirect" url="confirm.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectProfileSetup" stopProcessing="true">
                    <match url="^profile-setup$" />
                    <action type="Redirect" url="profile-setup.html" redirectType="Permanent" />
                </rule>
                <rule name="RedirectEventDetails" stopProcessing="true">
                    <match url="^event-details$" />
                    <action type="Redirect" url="event-details.html" redirectType="Permanent" />
                </rule>

                <!-- Handle event-details with query parameters -->
                <rule name="RedirectEventDetailsWithQuery" stopProcessing="true">
                    <match url="^event-details$" />
                    <conditions>
                        <add input="{QUERY_STRING}" pattern=".*" />
                    </conditions>
                    <action type="Redirect" url="event-details.html?{C:0}" redirectType="Permanent" />
                </rule>
            </rules>
        </rewrite>

        <!-- Custom headers for CORS and security -->
        <httpProtocol>
            <customHeaders>
                <add name="Access-Control-Allow-Origin" value="*" />
                <add name="Access-Control-Allow-Methods" value="GET, POST, PUT, DELETE, OPTIONS" />
                <add name="Access-Control-Allow-Headers" value="Origin, X-Requested-With, Content-Type, Accept, Authorization" />
                <add name="X-Content-Type-Options" value="nosniff" />
                <add name="X-Frame-Options" value="DENY" />
                <add name="X-XSS-Protection" value="1; mode=block" />
            </customHeaders>
        </httpProtocol>

        <!-- Static content caching -->
        <staticContent>
            <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="30.00:00:00" />
        </staticContent>

        <!-- Error pages -->
        <httpErrors errorMode="Custom" defaultResponseMode="Redirect">
            <remove statusCode="404" subStatusCode="-1" />
            <remove statusCode="403" subStatusCode="-1" />
            <remove statusCode="500" subStatusCode="-1" />
            <error statusCode="404" responseMode="Redirect" path="/index.html" />
            <error statusCode="403" responseMode="Redirect" path="/index.html" />
            <error statusCode="500" responseMode="Redirect" path="/index.html" />
        </httpErrors>

        <!-- Default documents -->
        <defaultDocument>
            <files>
                <clear />
                <add value="index.html" />
                <add value="dashboard.html" />
            </files>
        </defaultDocument>

        <!-- GZIP compression -->
        <urlCompression doStaticCompression="true" doDynamicCompression="true" />

        <!-- Security: Hide server information -->
        <security>
            <requestFiltering removeServerHeader="true">
                <!-- Block access to sensitive files -->
                <hiddenSegments>
                    <add segment="web.config" />
                    <add segment=".htaccess" />
                    <add segment=".git" />
                    <add segment=".gitignore" />
                    <add segment="README.md" />
                    <add segment=".CadvAWS" />
                </hiddenSegments>
                <fileExtensions>
                    <add fileExtension=".md" allowed="false" />
                    <add fileExtension=".config" allowed="false" />
                </fileExtensions>
            </requestFiltering>
        </security>
    </system.webServer>

    <!-- MIME types for static files -->
    <system.webServer>
        <staticContent>
            <mimeMap fileExtension=".json" mimeType="application/json" />
            <mimeMap fileExtension=".js" mimeType="application/javascript" />
            <mimeMap fileExtension=".css" mimeType="text/css" />
            <mimeMap fileExtension=".svg" mimeType="image/svg+xml" />
            <mimeMap fileExtension=".woff" mimeType="font/woff" />
            <mimeMap fileExtension=".woff2" mimeType="font/woff2" />
        </staticContent>
    </system.webServer>
</configuration>
